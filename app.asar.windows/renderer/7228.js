(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[7228,623],{26978:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a});var n=o(23645),i=o.n(n)()((function(e){return e[1]}));i.push([e.id,"#editor-container[data-v-117f9b53] .sheet-viewer {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  overflow: auto;\n  z-index: -1;\n  outline: none;\n  visibility: hidden;\n}\n#editor-container[data-v-117f9b53] .sheet-viewer.active {\n  z-index: 0;\n  visibility: visible;\n}\n.sheet-rendering-mask[data-v-117f9b53] {\n  z-index: 99;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n.editor-tooltip[data-v-117f9b53] {\n  background: var(--uk-popover-background, rgba(255, 255, 255, 0.7));\n  color: var(--uk-global-color, #27292a);\n  border-radius: 5px;\n  backdrop-filter: blur(30px);\n  filter: drop-shadow(0px 5px 20px rgba(0, 0, 0, 0.35));\n  position: absolute;\n  padding: 8px 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  pointer-events: none;\n  font-weight: normal;\n}\n.editor-tooltip[data-v-117f9b53]::before {\n  content: ' ';\n  display: block;\n  position: absolute;\n  width: 0;\n  height: 0;\n  border-style: solid;\n  border-color: var(--uk-popover-arrow-mask-border, rgba(232, 232, 232, 0));\n  border-width: 5px;\n  top: 100%;\n  left: calc(50%);\n  margin-left: -5px;\n  border-top-color: var(--uk-popover-background, rgba(255, 255, 255, 0.7));\n}\n",""]);const a=i},40623:(e,t,o)=>{"use strict";var n;o.d(t,{v:()=>n,w:()=>i}),function(e){e.LOGICRIGHT="org.xmind.ui.logic.right",e.LOGICLEFT="org.xmind.ui.logic.left",e.TREERIGHT="org.xmind.ui.tree.right",e.TREELEFT="org.xmind.ui.tree.left",e.TREESIDED="org.xmind.ui.timeline.vertical",e.ORGCHARTDOWN="org.xmind.ui.org-chart.down",e.ORGCHARTUP="org.xmind.ui.org-chart.up",e.MAPCLOCKWISE="org.xmind.ui.map.clockwise",e.MAPANTICLOCKWISE="org.xmind.ui.map.anticlockwise",e.MAP="org.xmind.ui.map",e.MAPUNBALANCED="org.xmind.ui.map.unbalanced",e.MAPFLOATING="org.xmind.ui.map.floating",e.MAPFLOATINGCLOCKWISE="org.xmind.ui.map.floating.clockwise",e.MAPFLOATINGANTICLOCKWISE="org.xmind.ui.map.floating.anticlockwise",e.TIMELINETHROUGHVERTICAL="org.xmind.ui.timeline.through.vertical",e.TIMELINESIDEDHORIZONTAL="org.xmind.ui.timeline.sided.horizontal",e.TIMELINEHORIZONTAL="org.xmind.ui.timeline.horizontal",e.FISHBONELEFTHEADED="org.xmind.ui.fishbone.leftHeaded",e.LEFTHEADTOPBONE="org.xmind.ui.fishbone.structure.lefthead.topbone",e.LEFTHEADBOTTOMBONE="org.xmind.ui.fishbone.structure.lefthead.bottombone",e.FISHBONERIGHTHEADED="org.xmind.ui.fishbone.rightHeaded",e.RIGHTHEADTOPBONE="org.xmind.ui.fishbone.structure.righthead.topbone",e.RIGHTHEADBOTTOMBONE="org.xmind.ui.fishbone.structure.righthead.bottombone",e.SPREADSHEET="org.xmind.ui.spreadsheet",e.COLUMNSPREADSHEET="org.xmind.ui.spreadsheet.column",e.TREETABLE="org.xmind.ui.treetable",e.TOPTITLETREETABLE="org.xmind.ui.treetable.toptitle",e.SPREADSHEETROW="org.xmind.ui.structure.spreadsheet.row",e.SPREADSHEETCOLUMN="org.xmind.ui.structure.column.spreadsheet",e.FISHBONELEFTHEADTOP="org.xmind.ui.fishbone.leftHeaded.top",e.FISHBONELEFTHEADBOTTOM="org.xmind.ui.fishbone.leftHeaded.bottom",e.FISHBONERIGHTHEADTOP="org.xmind.ui.fishbone.rightHeaded.top",e.FISHBONERIGHTHEADBOTTOM="org.xmind.ui.fishbone.rightHeaded.bottom",e.TIMELINEHORIZONTALUP="org.xmind.ui.timeline.horizontal.up",e.TIMELINEHORIZONTALDOWN="org.xmind.ui.timeline.horizontal.down",e.LOGICCHARTRIGHT="org.xmind.ui.logic-chart.right",e.LOGICCHARTLEFT="org.xmind.ui.logic-chart.left",e.BRACERIGHT="org.xmind.ui.brace.right",e.BRACELEFT="org.xmind.ui.brace.left",e.TIMELINEVERTICAL="org.xmind.ui.timeline.vertical"}(n||(n={}));const i={[n.MAPUNBALANCED]:"map-unbalance",[n.MAPCLOCKWISE]:"map-clockwise",[n.LOGICRIGHT]:"logic-right",[n.LOGICLEFT]:"logic-left",[n.BRACERIGHT]:"brace-right",[n.BRACELEFT]:"brace-left",[n.TREERIGHT]:"tree-right",[n.TREELEFT]:"tree-left",[n.ORGCHARTDOWN]:"org-down",[n.ORGCHARTUP]:"org-up",[n.FISHBONELEFTHEADED]:"fishbone-left",[n.FISHBONERIGHTHEADED]:"fishbone-right",[n.TIMELINEHORIZONTAL]:"timeline-horizontal",[n.TIMELINEVERTICAL]:"timeline-vertical",[n.TIMELINETHROUGHVERTICAL]:"timeline-through-vertical",[n.TIMELINESIDEDHORIZONTAL]:"timeline-sided-horizontal",[n.SPREADSHEET]:"matrix-row",[n.COLUMNSPREADSHEET]:"matrix-column",[n.TOPTITLETREETABLE]:"tree-table-column",[n.TREETABLE]:"tree-table-row"}},83063:(e,t,o)=>{"use strict";o.d(t,{F:()=>f});var n=o(71017),i=o.n(n),a=o(94593),r=o(72298),d=o(86633),l=o(57147),c=o(67657),s=o(84374),u=o(78152),m=o(13382),v=o(5893),p=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};const h=(0,d.ZP)("editor:attachment"),f=(e,t)=>p(void 0,void 0,void 0,(function*(){const{getResourceUrlByXapUrl:o}=(0,s.nZ)(),n=yield o(t),i=(0,v.iZ)(n);g(e,i)})),g=(e,t)=>p(void 0,void 0,void 0,(function*(){const{T:o}=(0,u.JE)(),{lastSaveDirectory:n,doNotShowAttachmentMessageAgain:a,setDoNotShowAttachmentMessageAgain:r}=(0,u._I)();let d=e,l="";const s=i().extname(t);try{l=n||c.app.getPath("downloads")}catch(e){l="downloads"}if(d&&!d.endsWith(s)&&(d+=s),a)I(t,l,d);else{const{response:e,checkboxChecked:n}=yield c.dialog.showMessageBox({title:"Xmind",message:o("Trying to Open Attachment"),detail:o("Xmind will save this attachment to $1 and open with default application in your system.",l),checkboxLabel:o("Don't show this message again."),buttons:[o("Save and Open"),o("Cancel")],defaultId:0,cancelId:1});0===e&&(n&&r(),I(t,l,d))}})),I=(e,t,o)=>p(void 0,void 0,void 0,(function*(){const{T:n}=(0,u.JE)(),{setLastDirectory:d}=(0,u._I)();o=(0,v.N6)(o);try{a.Z.accessSync(t,l.constants.F_OK|l.constants.W_OK);const n=(0,v.AK)(t,o),d=i().join(t,n);yield a.Z.copyFile(e,d),yield r.shell.openPath(d)}catch(a){h.info("Failed to save and open attachment",a);const[r]=yield(0,m.N0)({title:"Xmind",message:n("Failed to Save File"),detail:n("Xmind doesn't have permission to save file to $1, please choose another folder to save.",t),buttons:[n("Choose Folder"),n("Cancel")],defaultId:0,cancelId:1});if(0===r){const t=yield(0,m.ZZ)({title:"Save",suggestPath:{suggestedName:o}});if(t){const n=i().dirname(t);d({lastSaveDirectory:n}),yield I(e,n,o)}}}}))},31621:(e,t,o)=>{"use strict";o.d(t,{Q:()=>g,U:()=>I});var n=o(71017),i=o.n(n),a=o(94593),r=o(72298),d=o(86633),l=o(67657),c=o(78152),s=o(57147),u=o(5893),m=o(13382),v=o(84374),p=o(1171),h=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};const f=(0,d.ZP)("editor:hyperlink"),g=e=>h(void 0,void 0,void 0,(function*(){const{T:t}=(0,c.JE)(),{source:o}=(0,p.F)();let n,d=e;if(d.includes("file:")&&(d=d.slice(5)),i().isAbsolute(d))n=d;else{if(!o.startsWith("file:"))return;{const e=(0,u.iZ)(o),t=i().dirname(e);n=i().join(t,d)}}try{a.Z.accessSync(n,s.constants.F_OK),yield r.shell.openPath(n)}catch(e){f.info("Failed to open file:",e),yield(0,m.N0)({title:"Xmind",message:t("Failed to open this file link."),detail:t("Probably the location or name of this file/folder is changed."),buttons:[t("OK")],defaultId:0})}})),I=(e,t)=>{const{T:o}=(0,c.JE)(),{executeMutationAction:n,executePropertyAction:i,document:a,setActiveSheetId:r}=(0,v.nZ)(),d=e.replace("xmind:#",""),s=a.value.query({id:d});if(s){const e=a.value.query({id:t}).asTopic().ownerSheet,o=s.asTopic().ownerSheet;e.id!==o.id&&r(o.id),n({name:"mutate:selectTopics",payload:{topics:[d],centerOn:!0}})}else{0===l.dialog.showMessageBoxSync({title:o("Invalid Topic Link"),message:o("The target topic may have been deleted. Do you want to delete this topic link as well?"),buttons:[o("Delete It"),o("No")],defaultId:0,cancelId:1})&&i({name:"mutateProperty:topicLink",inputValue:""})}}},57228:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>ve});var n=o(2954),i=o(78152),a=o(63111),r=o(27049),d=o(46016),l=o(12455),c=o(84374),s=o(1171),u=o(53775),m=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};var v=o(71017),p=o.n(v),h=o(57310),f=o.n(h),g=o(63477),I=o.n(g),b=o(90435),y=o(54856),T=o(96829),E=o(13382),w=o(19741),S=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};function k(){const e=(0,w.y)(),t=(0,d.$)(),o=(0,s.F)(),a=b.ZP.route((0,y.K3)(window.editorId),(()=>S(this,void 0,void 0,(function*(){if((0,s.F)().emptyEditorView)return{canceled:!1};const e=(0,l.A)(),t=(0,i.km)(),{activeSheetId:o,currentZoomScale:n,sheets:a}=(0,c.nZ)();t.updateLastViewStatuses({id:o.value,lastSheetIndex:a.value.findIndex((e=>e.id===o.value)),geometryStatus:{scale:n.value}}),yield new Promise((e=>setTimeout(e,0)));const r=(0,s.F)();if(r.isDirty){const t=yield function(){return S(this,void 0,void 0,(function*(){const e=(0,i.JE)().T,t=e("Save"),o=e("Don't Save"),n=e("Cancel"),a=[];a.push(t,o,n);const[r]=yield(0,E.N0)({type:"none",title:"Xmind",message:e("Do you want to save the changes?"),detail:e("Your changes will be lost if you don't save them."),buttons:a,defaultId:a.indexOf(t),cancelId:a.indexOf(n),noLink:!0});if(r==a.indexOf(o))return!0;if(r==a.indexOf(t)){return yield O()}return!1}))}();return t&&(null==e||e.setAlive(!1),yield r.close()),{canceled:!t}}return null==e||e.setAlive(!1),yield r.close(),{}}))));(0,n.bv)((()=>{e.registerCommands([{id:"save",provider:`editor/${window.editorId}`,enabledFn:()=>o.isDirty,handler:()=>{o.canSave()?O():M()}},{id:"saveAs",provider:`editor/${window.editorId}`,enabledFn:()=>t.isWorkbenchReady,handler:()=>{M()}},{id:"saveSheetAs",provider:`editor/${window.editorId}`,enabledFn:()=>t.isWorkbenchReady,handler:A}])})),(0,n.Jd)((()=>{e.unregisterCommands([{id:"save",provider:`editor/${window.editorId}`},{id:"saveAs",provider:`editor/${window.editorId}`},{id:"saveSheetAs",provider:`editor/${window.editorId}`}]),a()}))}function O(){return S(this,void 0,void 0,(function*(){const e=(0,s.F)(),{canSave:t}=(0,s.F)(),o=(0,c.nZ)().document.value,n=o.metadataFor(c.aX.KnownMetaKey.DataStructureVersion)||"1";if(parseInt(n)<parseInt(c.aX.DocumentDataStructureVersion)){const e=(e,...t)=>(0,i.JE)().T(e,...t),t=yield(0,E.yr)(e);if(t.toSave)return(0,c.nZ)().changeDoc(o.asMutable().metadataFor(c.aX.KnownMetaKey.DataStructureVersion,c.aX.DocumentDataStructureVersion).commit()),yield O(),!0;if(t.toSaveAs){return yield M()}return!1}if(!t())return yield M();yield e.save();const{markDocumentSaved:a}=(0,c.nZ)();return a(),!0}))}function M(){return S(this,void 0,void 0,(function*(){const e=(0,s.F)(),t=yield e.getSaveAsHandlers();if(!t||!t.length)throw new Error("No save-as handlers available.");return t.length,yield x(t[0])}))}function A(e){return S(this,void 0,void 0,(function*(){const{document:t}=(0,c.nZ)(),o=(0,i.JE)().T,n=t.value.sheets[e];if(!n)return;const a=n.rootTopic.title||"",r=yield(0,E.ZZ)({title:"Save Sheet As",suggestPath:{suggestedName:a},filters:[{name:o("Xmind Workbook"),extensions:["xmind"]}]});if(!r)return!1;const d=r;return yield(0,s.F)().saveSheetAs(e,d),!0}))}function x(e){return S(this,void 0,void 0,(function*(){const t=yield e.prompt();if(!t)return!1;const o=(0,c.nZ)().document.value,n=o.metadataFor(c.aX.KnownMetaKey.DataStructureVersion)||"1";parseInt(n)<parseInt(c.aX.DocumentDataStructureVersion)&&(0,c.nZ)().changeDoc(o.asMutable().metadataFor(c.aX.KnownMetaKey.DataStructureVersion,c.aX.DocumentDataStructureVersion).commit());const i=(0,s.F)(),a=i.source;yield i.saveAs(t);const{markDocumentSaved:r,clearUndo:d}=(0,c.nZ)();return(null==a?void 0:a.startsWith("file:"))&&d(),r(),!0}))}var P=o(86633),C=o(7104),L=o(5893),R=o(18621),F=o(64805),D=o(95246),B=o(18264),H=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};const N=(0,P.ZP)("editor:fm");function Z(){const e=(0,n.FN)().proxy;!function(){const e=(0,s.F)();(0,n.bv)((()=>{e.fileId||((0,r.E)().updateEditorVisible(!1),e.waitInited().then((()=>{e.open().then((()=>{(0,c.pk)().changeFile({id:e.fileId,stage:e.stage})})).catch((t=>{e.handleOpenError(t).then((e=>{const{recovered:o=!1,prompted:n=!1}=e||{};if(!o){if(!n)return b.ZP.fetch(y.Fx,{name:"dialog-problem",payload:{name:"OpenError",message:t.message||t,stack:t.stack,code:"OPEN_FILE"}}).then((()=>{window.close()}));window.close()}}))}))})))}))}(),function(){const e=(0,s.F)();window.addEventListener("focus",o);let t=!1;function o(){e.fileId&&(t||(0,l.A)().saving||(t=!0,e.heartbeatTest().then((e=>{setTimeout((()=>{t=!1}),0);const{shouldClose:n=!1}=e||{};n&&(window.removeEventListener("focus",o),window.close())}))))}(0,n.Jd)((()=>{window.removeEventListener("focus",o)}))}(),k();const t=(0,s.F)();t.injectThumbnailGenerator({generateThumbnail:function(e){return H(this,void 0,void 0,(function*(){const t=(0,s.F)(),{getSheetViewer:o,activeSheetId:n,document:i}=(0,c.nZ)(),a=t.lastThumbnail,r=o(e||n.value),d=i.value.sheets.find((t=>t.id===(e||n.value))).clone(),l=JSON.stringify(d).includes("全瀨體");let u;const m=42/26;try{if(l){const e=yield r.exportSVGImage({padding:c.viewerKit.insetsOf(16),aspectRatio:m,maximumWidth:2100,maximumHeight:1300,opaqueBackground:!0,disableEmbedFonts:!0}),t=e.size,o=e.svg;if("yes"!==(yield Promise.race([b.ZP.fetch(y.Lk),new Promise((e=>setTimeout(e,2500)))])))return a;u=yield Promise.race([b.ZP.fetch(y.Zm,{data:o,width:Math.round(t.width),height:Math.round(t.height)}),new Promise((e=>setTimeout(e,18e4)))])}else u=yield r.exportRasterImage("png",{padding:c.viewerKit.insetsOf(16),aspectRatio:m,maximumWidth:2100,maximumHeight:1300,opaqueBackground:!0})}catch(e){N.info("generateThumbnail fail"+e)}if(u){const e=u.replace(/^data:image\/png;base64,/,"");return Buffer.from(e,"base64")}return a||Buffer.from("","base64")}))}});const o=[t.addFileEventHook("close",(e=>{"closed"===e&&(0,r.E)().updateEditorVisible(!1)})),t.addFileEventHook("save",(e=>H(this,void 0,void 0,(function*(){if("presave"===e){const e=p().join((0,C.N8)(),window.editorId);let t=null;try{t=yield(0,L.cs)(e)}catch(e){return void N.error((0,T.SC)(e))}t>a.tZ.FILE_SIZE&&b.ZP.fetch(y.Fx,{name:"dialog-progress",parentId:window.id,wait:!0,query:{type:"xmind",editorId:window.editorId}})}})))),t.addFileEventHook("saveSheet",(e=>{"postsavesheet"===e&&(0,R.L9)({eventCategory:"Save",eventAction:"saveSheet",eventValue:1})})),t.addFileEventHook("close",(e=>{"closed"===e&&(0,R.L9)({eventCategory:"Quit",eventAction:"closeTab",eventValue:1})})),t.addFileEventHook("open",(t=>H(this,void 0,void 0,(function*(){"postopen"===t&&function(){H(this,void 0,void 0,(function*(){const t=(0,r.E)(),o=(0,s.F)(),l=(0,i.km)();t.updateMindMapCreated(!0),o.updateMemento(!0);let m=!1;const v=(0,n.YP)((0,c.nZ)().activeSheetViewer,(e=>{var t,o,n,a;if(e){const d=l.lastViewStatuses.find((t=>t.id===e.sheetId)),s=(null===(t=null==d?void 0:d.geometryStatus)||void 0===t?void 0:t.scale)||function(){var e,t,o;const{activeSheetId:n}=(0,c.nZ)(),{initialZoomLevel:a}=(0,i.S)(),d=null===(e=(0,r.E)().sheetStatuses)||void 0===e?void 0:e[n.value];let l=null!==(t=null==d?void 0:d.zoomScale)&&void 0!==t?t:(0,D.GI)(a)/100;return l=null!==(o=null==d?void 0:d.suggestedZoomScale)&&void 0!==o?o:l,l}(),u=null!==(o=e.getViewerCenter())&&void 0!==o?o:{x:(null===(n=null==d?void 0:d.geometryStatus)||void 0===n?void 0:n.x)||0,y:(null===(a=null==d?void 0:d.geometryStatus)||void 0===a?void 0:a.y)||0};e.centerOn(u,s),m=!0,v()}}));(0,n.YP)((0,c.nZ)().activeSheetViewer,(e=>H(this,void 0,void 0,(function*(){if(!m)return;e&&function(e){var t,o,n,a,d;if(!(null==e?void 0:e.sheetId))return;const l=e.sheetId,{initialZoomLevel:c}=(0,i.S)(),s=null===(t=(0,r.E)().sheetStatuses)||void 0===t?void 0:t[l];let u=null!==(o=null==s?void 0:s.zoomScale)&&void 0!==o?o:(0,D.GI)(c);u=null!==(n=null==s?void 0:s.suggestedZoomScale)&&void 0!==n?n:u;const m=e.getViewerState(),v=null!==(a=m.zoomScale)&&void 0!==a?a:1,p=null!==(d=e.getViewerCenter())&&void 0!==d?d:{x:0,y:0};u!==100*v&&(e.centerOn(p,u/100),e.changeZoomScale(u/100));(0,r.E)().updateSheetStatus({id:l,zoomScale:u})}(e);const{updateSheetRendering:t,sheetRenderingStartAt:o,sheetRendering:n}=(0,r.E)();if(n&&o){const e=(new Date).getTime()-o;e<a.oY&&(yield(0,T._v)(a.oY-e)),t({sheetRendering:!1,sheetRenderingStartAt:null})}e.restoreViewportState()})))),(0,n.YP)((0,c.nZ)().currentZoomScale,(e=>{if(null==e)return;const{activeSheetId:o}=(0,c.nZ)();(null==o?void 0:o.value)&&t.updateSheetStatus({id:o.value,zoomScale:100*e})})),(0,n.YP)((()=>l.isAutoBeginnerModeVisible),(e=>t.changeBeginnerModeVisible(e))),(0,n.YP)((()=>l.hasShownTryPicthMode),(e=>{e&&t.changeTryPicthModeVisible(!1)}));const p=3e5,h=(0,u.P2)((()=>{o.makeDocumentCache()}),p);(0,n.YP)((()=>(0,c.nZ)().document.value),(()=>{h()})),(0,n.YP)((()=>(0,B.U)().isFocusMissing),(e=>{var t;(0,d.$)().isOutlinerMode||e&&(null===(t=(0,c.nZ)().activeSheetViewer.value)||void 0===t||t.focus())}));const g=o.source.startsWith("new:"),b=l.hasShownTryPicthMode;l.hasShownTutorial?g||b||t.changeTryPicthModeVisible(!0):setTimeout((()=>{t.changeBeginnerDialogVisible(!0),(0,n.YP)((()=>l.hasShownTutorial),(e=>{e&&t.changeBeginnerDialogVisible(!1)})),g||b||(0,n.YP)((()=>[l.hasShownTutorial,l.isAutoBeginnerModeVisible]),(([e,o])=>{l.hasShownTryPicthMode||!0!==e||!1!==o||t.changeTryPicthModeVisible(!0)}))}),1400);const y=(0,i.JE)().T,w=o.docCompatibility;w===c.viewerKit.LayoutEngineIncompatibility.UnsupportedFeatures?yield(0,E.R2)(y):w!==c.viewerKit.LayoutEngineIncompatibility.ObsoleteFeatures&&w!==c.viewerKit.LayoutEngineIncompatibility.Undetermined||(yield(0,E.W5)(e),o.changeDirty(!0),o.updateMemento(!1));const S=o.source,k=f().parse(S),O=I().parse(k.query).template||"default";if("new:"===k.protocol&&"default"===O){const e=(0,n.YP)((0,c.nZ)().activeSheetViewerInited,(t=>{if(t){const t=(0,n.YP)((()=>(0,c.nZ)().selection.value),(e=>{e.modelIds.length>0&&((0,d.$)().updateRightBarPanel({visible:!0,panel:F.QN.THEME,tab:F.x9.MAP}),t())}));e()}}))}const M=(yield o.stage.getDocument()).sheets;if(M.length>0){const e=l.lastViewStatuses.find((e=>M.find((t=>t.id===e.id))));(0,c.nZ)().setInitialSheetId((null==e?void 0:e.id)||M[0].id)}document.addEventListener("mousedown",(e=>{if((0,d.$)().editorMode===a.hO){const t=(0,c.nZ)().activeSheetViewer.value;t&&!t.includesNode(e.target)&&(0,c.nZ)().executeAction({name:"mutate:interruptingEditSession"})}}))}))}()}))))];(0,n.YP)((()=>(0,l.A)().saving),(e=>{e||b.ZP.fetch(y.g_,{name:"dialog-progress"}).catch((()=>N.warn("Close process dialog failed.")))})),(0,n.YP)((()=>(0,i.S)().cjkFontFamily),(e=>{const{changeDefaultCJKFontFamily:t}=(0,c.nZ)();t(e)}),{immediate:!0}),(0,n.Jd)((()=>{o.forEach((e=>e()))})),window.canPreformUIkitMutationObserver=({target:e})=>{var t;return!(e&&e instanceof Element)||!(null===(t=(0,c.nZ)().activeSheetViewer.value)||void 0===t?void 0:t.includesNode(e))}}var V=o(94593),_=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function d(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}l((n=n.apply(e,t||[])).next())}))};const K=(0,P.ZP)("editor:fm");function G(){return _(this,void 0,void 0,(function*(){const e=(0,i.km)(),t=(0,s.F)(),{activeSheetId:o}=(0,c.nZ)(),n=e.recentlyOpenedItems,a=t.source;let r=null;if(!a)return;const d=n.find((e=>e.source===a));let l=t.lastThumbnail;const u=t.thumbnailGenerator;if((null==l||0===l.byteLength)&&u)try{l=yield u.generateThumbnail(o.value)}catch(e){K.error("Export thumbnail failed when update recent",(0,T.SC)(e))}if(l){r=d&&d.previewUrl&&d.previewUrl.endsWith("png")?d.previewUrl:`recent/${(0,T.hb)()}.png`;try{yield V.Z.ensureDir(p().join((0,C.D8)(),"recent")),yield V.Z.writeFile(p().join((0,C.D8)(),r),Buffer.from(l))}catch(e){K.warn("something wrong when save recent preview img to appData directory",e)}}e.appendRecentlyOpenedItem({source:a,timestamp:(new Date).getTime(),previewUrl:r||d&&d.previewUrl})}))}var q=o(85786);var W=o(83063),J=o(31621),Y=o(20993);const U=()=>{const{document:e,properties:t,installTopicImageHandler:o,installClickLabelHandler:n,installClickMarkerHandler:a,installTopicWebVideoHandler:l,installClickTopicInfoHandler:s,installCheckTaskHandler:u}=(0,c.nZ)(),{T:m}=(0,i.JE)(),{setPopoverEditorVisible:v}=(0,d.$)(),{handleCommand:p}=(0,i.JX)();n((()=>{v("label")})),u((e=>{var t;(0,Y.fR)("done"===(null===(t=null==e?void 0:e.task)||void 0===t?void 0:t.status))})),o((e=>{var o;if(!e)return;const n=null===(o=t.value)||void 0===o?void 0:o.equation.value;(null==n?void 0:n.text)&&p("editor.showEquationEditor")})),a((e=>{if(!e)return;const t=e.markerId;t&&p("editor.showMarkerPopup",t)})),l((e=>{var t;const o=null===(t=null==e?void 0:e.webVideo)||void 0===t?void 0:t.embedUrl;o&&p("videoViewer",{url:o})})),s((t=>{if(!t)return;const{infoItemType:o,topicId:n}=t,i=e.value.query({id:n}).asTopic(),{title:a,href:d}=i;if("note"===o)v("notes");else if("topic-link"===o){if(!d)return;(0,J.U)(d,n)}else if("file-link"===o){if(!d)return;(0,J.Q)(d)}else if("web-link"===o){if(!d)return;(0,q.DL)(d,m)}else if("attachment"===o){if(!a||!d)return;(0,W.F)(a,d)}else"audio-note"===o?(e=>{const{audioRecording:t,updateAudioBarMode:o,audioBarMode:n}=(0,r.E)();if(t)return;o({audioBarMode:"open_new_audio_play"===n?"audio_play":"open_new_audio_play",audioTopicId:e,audioAutoplay:!0})})(n):"multiple"===o&&v("informationcard")}))};var $=o(57507);function z(e,t=!1){var o,n,a,r;const d={};if("separator"===e.type)return Object.assign({},e);d.click=e.click||function(){void 0!==e.arg?(0,i.JX)().handleCommand(e.commandId,e.arg):(0,i.JX)().handleCommand(e.commandId)};const c=null!==(o=(0,i.JX)().commandById(e.commandId))&&void 0!==o?o:null===(n=(0,l.A)())||void 0===n?void 0:n.commandById(e.commandId),s=c&&c.enabled;d.enabled=e.enabled||!!s||!1,d.label=null!==(r=null!==(a=e.label)&&void 0!==a?a:null==c?void 0:c.label)&&void 0!==r?r:"",e.interactive&&(d.label=d.label+"..."),d.accelerator=(0,i.f7)().formarKeybindingForMenu(e.accelerator||(0,i.f7)().keybindingByCommandId(e.commandId));const u=e.submenu&&((m=e.submenu)&&m.filter((e=>!function(e){return"---"===e||e&&"separator"===e.type}(e))).every(X));var m;d.submenu=e.submenu&&e.submenu.map((e=>z(e,u))),e.id&&(d.id=e.id);const v=(0,i.Yh)().isStatusValid,h=X(e);return v||t||!h&&!u||(d.icon=p().join((0,C.bY)(),"static/assets/images/pro/menu-pro.png")),d}function X(e){return a.TK.includes(e.commandId)}function j(e,t){return e in t?e:t.length>0?t[0]:""}const Q={validateTargetIsCallout:function(e,t,o){var n;const i=j(e.id,t);if(!i)return;return(null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic().topicType)===c.viewerKit.TopicType.Callout},getSelectedTopicInfo:function(e,t){const o=[],n=[];return e.forEach((e=>{const i=t.query({id:e}).asTopic();o.push(i),n.push(i.topicType)})),{selectedTopicList:o,selectedTopicTypeList:n}},validateIsIncludeMain:function(e,t){for(const o of e){const e=t.query({id:o}).asTopic();if(e.topicType===c.viewerKit.TopicType.Attached&&e.parentTopic.topicType===c.viewerKit.TopicType.Root)return!0}return!1},getTargetBranchByTopic:function(e,t,o){var n;const i=j(e.id,t);if(i)return null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic()},getContentOnEquation:function(e,t,o){var n;const i=j(e.topicId,t);if(!i)return;const a=o.query({id:i}).asTopic();if(a.imageIsMathJaxImage){const e=a.extensionBy(c.o9.Equation);return null===(n=null==e?void 0:e.content)||void 0===n?void 0:n.content}},getEmbedUrlOnWebVideo:function(e,t,o){var n;const i=j(e.topicId,t);if(!i)return;const a=o.query({id:i}).asTopic().extensionBy(c.o9.WebVideo);return null===(n=null==a?void 0:a.content)||void 0===n?void 0:n.embedUrl},getMarkerInfo:function(e,t){if(!j(e.topicId,t))return;const o=e.id;if(!o)return;const{markerModule:n}=(0,c.nZ)();return{markerId:o,isMissingMarker:!n.getMarkerInfoById(o)}},getLabelInfo:function(e,t,o){const n=j(e.topicId,t);if(!n)return;const i=e.label,a=o.query({id:n}).asTopic().labels.filter((e=>e!==i)).join(",");return{selectedLabel:i,resultLabelJoinedStringForDelete:a}},getTaskInfo:function(e,t,o){var n;const i=j(e.topicId,t);if(!i)return;const a=null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic();if(!a)return;const r=Object.assign({},a.task);return null!==a.aggregatedCountOfTodos&&a.aggregatedCountOfTodos===a.aggregatedCountOfCheckedTodos&&(r.status="done"),r},getInfoButtonType:function(e,t){const o=j(e.topicId,t);if(!o)return;const{activeSheetViewer:n}=(0,c.nZ)();return n.value.getInfoItemTypeForTopicById(o)},validateIsFolderLink:function(e,t,o){var n;const i=j(e.topicId,t);if(!i)return;const a=null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic(),r="file:";let d=!1;if(a.href&&a.href.startsWith(r)){const e=a.href.slice(5);try{d=V.Z.isDirectorySync(e)}catch(e){}}return d},getTopicIdByInfoButton:function(e,t,o){var n;const i=j(e.topicId,t);if(!i)return;const a=null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic();return null==a?void 0:a.id}};var ee=o(40623);const{TopicType:te}=c.viewerKit;function oe(e){if(!0!==e.hideOnDisabled)return!0;if(Object.keys(e).includes("enabled"))return e.enabled;const t=(0,i.JX)().commandById(e.commandId);return!!t&&t.enabled}function ne(e){return!0}const ie="editor.toggleBranchOnly";function ae(e){if(e.commandId===ie&&void 0!==e.arg){let t=e.arg;for(;t&&t.topicType!==te.Root;){if(t.topicType===te.Detached)return!1;if(t.topicType===te.Callout)return!1;if(t.topicType===te.Summary)return!1;t=t.parentTopic}}return!0}function re(e,t,o,n,a){var r,d;const l=(0,i.JE)().T,{activeSheet:s}=(0,c.nZ)(),u=s.value.rootTopic.structureClass||(null===(d=null===(r=s.value.extensionBy("org.xmind.ui.skeleton.structure.style"))||void 0===r?void 0:r.content)||void 0===d?void 0:d.centralTopic),m=[ee.v.SPREADSHEET,ee.v.COLUMNSPREADSHEET].includes(u),v=[{commandId:"editor.showHyperlinkEditor",label:l("Webpage")},{commandId:"editor.showTopiclinkEditor",label:l("Topic")},{commandId:"editor.addFileLink",label:l("Local File"),hideOnMAS:!0},{commandId:"editor.addFolderLink",label:l("Local Folder"),hideOnMAS:!0}].filter(ne),p=[{commandId:"editor.showNotesEditor",label:l("Note")},{commandId:"editor.showLabelEditor",label:l("Label")},{commandId:"editor.addTask",label:l("Task")},{submenu:v,label:l("Link(noun)"),enabled:!0},{type:"separator"},{commandId:"editor.addAttachmentOnNewTopic",label:l("Attachment")},{commandId:"editor.addAudioOnNewTopic",label:l("Audio Note")},{type:"separator"},{commandId:"workbench.toggleMarkerPanel",label:l("Marker")},{commandId:"workbench.toggleStickerPanel",label:l("Sticker")},{commandId:"workbench.toggleIllustrationPanel",label:l("Illustration")},{commandId:"editor.addLocalImage",label:l("Local Image")},{commandId:"editor.showEquationEditor",label:l("Equation")}],h=[{commandId:"editor.removeMarker",label:l("Marker"),hideOnDisabled:!0},{commandId:"editor.removeLabel",label:l("Label"),hideOnDisabled:!0},{commandId:"editor.removeTask",label:l("Task"),hideOnDisabled:!0},{commandId:"editor.removeLink",label:l("Link"),hideOnDisabled:!0}].filter(oe),f=[{commandId:"editor.clearText",label:l("Clear Text"),hideOnDisabled:!0},{commandId:"editor.removeMarkerForTopicContextMenu",label:l("Remove Marker"),hideOnDisabled:!0},{commandId:"editor.removeLabelForTopicContextMenu",label:l("Remove Label"),hideOnDisabled:!0},{commandId:"editor.removeTaskForTopicContextMenu",label:l("Remove Task"),hideOnDisabled:!0},{commandId:"editor.removeLinkForTopicContextMenu",label:l("Remove Link"),hideOnDisabled:!0},{submenu:h,commandId:"editor.removeTopicContent",label:l("Remove"),hideOnDisabled:!0}],g=[{commandId:"workbench.exportBranchPng",label:l("PNG"),interactive:!0},{commandId:"workbench.exportBranchSvg",label:l("SVG"),interactive:!0},{commandId:"workbench.exportBranchPdf",label:l("PDF"),interactive:!0},{commandId:"workbench.exportBranchMd",label:l("Markdown"),arg:{selectedTopicList:t},interactive:!0}],I=[{commandId:"editor.alignTopicsToLeft",label:l("Left")},{commandId:"editor.alignTopicsToCenter",label:l("Center")},{commandId:"editor.alignTopicsToRight",label:l("Right")},{type:"separator"},{commandId:"editor.alignTopicsToTop",label:l("Top")},{commandId:"editor.alignTopicsToMiddle",label:l("Middle")},{commandId:"editor.alignTopicsToBottom",label:l("Bottom")},{type:"separator"},{commandId:"editor.distributeTopicsHorizontally",label:l("Distribute Horizontally")},{commandId:"editor.distributeTopicsVertically",label:l("Distribute Vertically")}],b=[{commandId:"delete",label:l("Delete")},...f,{type:"separator"},{commandId:"editor.copyStyle",label:l("Copy Style")},{commandId:"editor.pasteStyle",label:l("Paste Style")},{commandId:"editor.resetStyle",label:l("Reset Style")}],y=[{submenu:p,label:l("Insert"),enabled:!0},{type:"separator"},{commandId:"cut",label:l("Cut"),hideOnIncludeSummary:!0},{commandId:"copy",label:l("Copy"),hideOnIncludeSummary:!0},{commandId:"paste",label:l("Paste"),hideOnIncludeSummary:!0},{commandId:"duplicate",label:l("Duplicate"),hideOnIncludeSummary:!0},{type:"separator"},{commandId:"delete",label:l("Delete")},{commandId:"deleteSingleTopic",label:l("Delete Single Topic"),hideOnIncludeSummary:!0},...f,{type:"separator"},{commandId:"editor.checkTask",label:l("Mark as Completed"),hideOnDisabled:!0},{commandId:"editor.uncheckTask",label:l("Mark as Uncompleted"),hideOnDisabled:!0},{commandId:"editor.cancelTask",label:l("Mark as Canceled"),hideOnDisabled:!0},{type:"separator"},{commandId:"editor.copyStyle",label:l("Copy Style")},{commandId:"editor.pasteStyle",label:l("Paste Style")},{commandId:"editor.resetStyle",label:l("Reset Style")},{type:"separator"},{commandId:"editor.toggleBranch",hideOnIncludeRoot:!0},{commandId:"editor.toggleAllBranch"},{type:"separator",hideOnIncludeRoot:!0},{submenu:g,label:l("Export Branch To"),hideOnIncludeRoot:!0,enabled:!m},{commandId:"printBranch",label:l("Print Branch"),hideOnIncludeRoot:!0,interactive:!0},{type:"separator",hideOnIncludeRoot:!0},{commandId:ie,hideOnIncludeRoot:!0,arg:a},{type:"separator",hideOnIncludeRoot:!0},{submenu:I,id:"align",label:l("Align Floating Topic"),enabled:!0},{commandId:"editor.newSheetFromTopic",label:l("New Sheet From Topic")},{type:"separator",showOnIncludeMain:!0},{commandId:"editor.resetPosition",label:l("Reset Position"),showOnIncludeMain:!0}];return e?b.filter(oe):y.filter(oe).filter((e=>function(e,t){return!Object.keys(e).includes("hideOnIncludeSummary")||(t.includes(te.Summary)?!e.hideOnIncludeSummary:!!e.hideOnIncludeSummary)}(e,o))).filter((e=>function(e,t){return!Object.keys(e).includes("hideOnIncludeRoot")||(t.includes(te.Root)?!e.hideOnIncludeRoot:!!e.hideOnIncludeRoot)}(e,o))).filter((e=>function(e,t){return!Object.keys(e).includes("showOnIncludeMain")||e.showOnIncludeMain&&t}(e,n))).filter(ae)}function de(e,t,o){const n=(0,i.JE)().T,a=[{commandId:"editor.editInfoItem",label:n("Edit")},{type:"separator"},{commandId:"editor.removeNote",label:n("Delete")},{type:"separator"},{commandId:"workbench.showNoteNavigationPanelAndSelect",label:n("View All Notes"),arg:o}],r=[{commandId:"editor.removeAudioNotes",label:n("Delete")},{type:"separator"},{commandId:"editor.saveAsAudioNote",label:n("Save As")}],d=[{commandId:"editor.removeAttachment",label:n("Delete")},{type:"separator"},{commandId:"editor.saveAsAttachment",label:n("Save As")}],l=[{commandId:"editor.addFileLink",label:n("Edit"),hideOnIsFolderLink:!0},{commandId:"editor.addFolderLink",label:n("Edit"),hideOnIsFolderLink:!1},{commandId:"editor.removeLink",label:n("Delete")}],s=[{commandId:"editor.showTopiclinkEditor",label:n("Edit")},{type:"separator"},{commandId:"editor.removeLink",label:n("Delete")}],u=[{commandId:"editor.editInfoItem",label:n("Edit")},{type:"separator"},{commandId:"editor.removeLink",label:n("Delete")}];switch(e){case c.viewerKit.InfoItemType.Multiple:return[];case c.viewerKit.InfoItemType.Note:return a;case c.viewerKit.InfoItemType.AudioNote:return r;case c.viewerKit.InfoItemType.Attachment:return d;case c.viewerKit.InfoItemType.FileLink:return l.filter((e=>function(e,t){return!Object.keys(e).includes("hideOnIsFolderLink")||(t?!e.hideOnIsFolderLink:!!e.hideOnIsFolderLink)}(e,t)));case c.viewerKit.InfoItemType.TopicLink:return s;case c.viewerKit.InfoItemType.WebLink:return u;default:return[]}}function le(){const{installContextMenuHandler:e}=(0,c.nZ)();e((e=>{var t;if("map"!==e.type)return;if(null!==e.viewerState.pointerTarget)return;const o=t=>{if((null==t?void 0:t.length)>0)return;const o=function(e){const t=(0,i.JE)().T;return[{label:t("Paste"),commandId:"paste",arg:{payload:{targetPoint:e}}},{type:"separator"},{commandId:"editor.preAddFloatingTopic",label:t("Insert Floating Topic")},{commandId:"editor.addRelationship",label:t("Insert Relationship")},{type:"separator"},{commandId:"editor.toggleAllBranch"},{type:"separator"},{commandId:"editor.focusAndSelectCenter",label:t("Go to Central Topic")},{commandId:"selectAll",label:t("Select All")}]}(e.contextMenuRequest.locationInContent).map((e=>z(e)));(0,$.k)(o,e.location)},{selection:n}=(0,c.nZ)();"none"!==(null===(t=n.value)||void 0===t?void 0:t.type)?ce(n,o):o([])})),e((e=>{var t,o;if("topic"!==e.type)return;const n=e.viewerState.pointerTarget;if("topic"!==(null==n?void 0:n.kind))return;const i=t=>{if(!(null==t?void 0:t.includes(n.id)))return;const o=Q.validateTargetIsCallout(n,t,e.sheet),i=Q.getSelectedTopicInfo(t,e.sheet);if(!i)return;const{selectedTopicList:a,selectedTopicTypeList:r}=i,d=re(o,a,r,Q.validateIsIncludeMain(t,e.sheet),Q.getTargetBranchByTopic(n,t,e.sheet)).map((e=>z(e)));(0,$.k)(d,e.location)},{selection:a}=(0,c.nZ)(),r=c.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=a.value)||void 0===t?void 0:t.type)||(null===(o=a.value)||void 0===o?void 0:o.modelIds[0])!==r[0]?ce(a,i):i(r)})),e((e=>{var t,o,n;if("boundary"!==e.type)return;const a=e.viewerState.pointerTarget;if("boundary"!==(null==a?void 0:a.kind))return;const r=t=>{if(!(null==t?void 0:t.includes(a.id)))return;const o=function(){const e=(0,i.JE)().T;return[{commandId:"editor.showEditBox",label:e("Edit")},{commandId:"delete",label:e("Delete")},{type:"separator"},{commandId:"editor.copyStyle",label:e("Copy Style")},{commandId:"editor.pasteStyle",label:e("Paste Style")},{commandId:"editor.resetStyle",label:e("Reset Style")}]}().map((e=>z(e)));(0,$.k)(o,e.location)},{selection:d}=(0,c.nZ)();"textInput"===e.viewerState.focus?se(d,r):"boundary"!==(null===(t=d.value)||void 0===t?void 0:t.type)||(null===(o=d.value)||void 0===o?void 0:o.modelIds[0])!==a.id?ce(d,r):r(null===(n=d.value)||void 0===n?void 0:n.modelIds)})),e((e=>{var t,o,n;if("relationship"!==e.type)return;const a=e.viewerState.pointerTarget;if("relationship"!==(null==a?void 0:a.kind))return;const r=t=>{if(!(null==t?void 0:t.includes(a.id)))return;const o=function(){const e=(0,i.JE)().T;return[{commandId:"editor.showEditBox",label:e("Edit")},{commandId:"delete",label:e("Delete")},{type:"separator"},{commandId:"editor.copyStyle",label:e("Copy Style")},{commandId:"editor.pasteStyle",label:e("Paste Style")},{commandId:"editor.resetStyle",label:e("Reset Style")}]}().map((e=>z(e)));(0,$.k)(o,e.location)},{selection:d}=(0,c.nZ)();"textInput"===e.viewerState.focus?se(d,r):"relationship"!==(null===(t=d.value)||void 0===t?void 0:t.type)||(null===(o=d.value)||void 0===o?void 0:o.modelIds[0])!==a.id?ce(d,r):r(null===(n=d.value)||void 0===n?void 0:n.modelIds)})),e((e=>{var t,o;if("image"!==e.type)return;const n=e.viewerState.pointerTarget;if("image"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=function(e,t){const o=(0,i.JE)().T,n=[{commandId:"editor.showEquationEditor",label:o("Edit")},{type:"separator"},{commandId:"cut",label:o("Cut"),arg:{payload:{equation:e}}},{commandId:"copy",label:o("Copy"),arg:{payload:{equation:e}}},{commandId:"delete",label:o("Delete")},{type:"separator"},{commandId:"editor.saveAsEquation",label:o("Save As")},{type:"separator"},{commandId:"editor.resizeEquation",label:o("Reset Size")}],a=[{commandId:"cut",label:o("Cut")},{commandId:"copy",label:o("Copy")},{commandId:"delete",label:o("Delete")},{type:"separator"},{commandId:"videoViewer",label:o("Play"),arg:{url:t}},{type:"separator"},{commandId:"editor.resetImage",label:o("Reset Size")}],r=[{commandId:"cut",label:o("Cut")},{commandId:"copy",label:o("Copy")},{commandId:"delete",label:o("Delete")},{type:"separator"},{commandId:"editor.saveAsImage",label:o("Save As")},{type:"separator"},{commandId:"editor.rotateImageLeft",label:o("Rotate Left")},{commandId:"editor.resetImage",label:o("Reset Size")}];return e?n:t?a:r}(Q.getContentOnEquation(n,t,e.sheet),Q.getEmbedUrlOnWebVideo(n,t,e.sheet)).map((e=>z(e)));(0,$.k)(o,e.location)},{selection:r}=(0,c.nZ)(),d=c.viewerKit.selectedTopicsFrom(e.viewerState.selection);"image"!==(null===(t=r.value)||void 0===t?void 0:t.type)||(null===(o=r.value)||void 0===o?void 0:o.modelIds[0])!==d[0]?ce(r,a):a(d)})),e((e=>{var t,o;if("marker"!==e.type)return;const n=e.viewerState.pointerTarget;if("marker"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=Q.getMarkerInfo(n,t);if(!o)return;const{markerId:a,isMissingMarker:r}=o,d=function(e,t){const o=(0,i.JE)().T,n=[{commandId:"editor.deleteMarker",label:o("Delete"),arg:{value:e}}],a=[{commandId:"editor.showMarkerPopup",label:o("Edit"),arg:e},{type:"separator"},{commandId:"cut",label:o("Cut"),arg:{payload:{markerId:e}}},{commandId:"copy",label:o("Copy"),arg:{payload:{markerId:e}}},{commandId:"editor.deleteMarker",label:o("Delete"),arg:{value:e}},{type:"separator"},{commandId:"workbench.showMarkerNavigationPanelAndSelect",label:o("Highlight Relevant Topics"),arg:e}];return t?n:a}(a,r).map((e=>z(e)));(0,$.k)(d,e.location)},{selection:r}=(0,c.nZ)(),d=c.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=r.value)||void 0===t?void 0:t.type)||(null===(o=r.value)||void 0===o?void 0:o.modelIds[0])!==d[0]?ce(r,a):a(d)})),e((e=>{var t,o;if("label"!==e.type)return;const n=e.viewerState.pointerTarget;if("label"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=Q.getLabelInfo(n,t,e.sheet);if(!o)return;const{selectedLabel:a,resultLabelJoinedStringForDelete:r}=o,d=function(e,t){const o=(0,i.JE)().T;return[{commandId:"editor.removeTopicLabel",label:o("Delete"),arg:{value:t}},{type:"separator"},{commandId:"workbench.showLabelNavigationPanelAndSelect",label:o("Highlight Relevant Topics"),arg:e}]}(a,r).map((e=>z(e)));(0,$.k)(d,e.location)},{selection:r}=(0,c.nZ)(),d=c.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=r.value)||void 0===t?void 0:t.type)||(null===(o=r.value)||void 0===o?void 0:o.modelIds[0])!==d[0]?ce(r,a):a(d)})),e((e=>{var t,o;if("infoButton"!==e.type)return;const n=e.viewerState.pointerTarget;if("info-button"!==(null==n?void 0:n.kind))return;const i=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=de(Q.getInfoButtonType(n,t),Q.validateIsFolderLink(n,t,e.sheet),Q.getTopicIdByInfoButton(n,t,e.sheet)).map((e=>z(e)));(0,$.k)(o,e.location)},{selection:a}=(0,c.nZ)(),r=c.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=a.value)||void 0===t?void 0:t.type)||(null===(o=a.value)||void 0===o?void 0:o.modelIds[0])!==r[0]?ce(a,i):i(r)})),e((e=>{var t,o;if("task"!==e.type)return;const n=e.viewerState.pointerTarget;if("task"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=function(e){const t=(0,i.JE)().T;return[{commandId:"editor.removeTask",label:t("Delete")},{commandId:"editor.cancelTask",label:t("Mark as Canceled")},{type:"separator"},{commandId:"workbench.showTaskNavigationPanelAndSelect",label:"done"===(null==e?void 0:e.status)?t("Highlight Completed Task"):t("Highlight Uncompleted Task"),arg:e}]}(Q.getTaskInfo(n,t,e.sheet)).map((e=>z(e)));(0,$.k)(o,e.location)},{selection:r}=(0,c.nZ)(),d=c.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=r.value)||void 0===t?void 0:t.type)||(null===(o=r.value)||void 0===o?void 0:o.modelIds[0])!==d[0]?ce(r,a):a(d)}))}const ce=(e,t)=>{const o=(0,n.YP)(e,(()=>{o&&o();const i=(0,n.YP)((()=>(0,l.A)().commands),(()=>{var o;i&&i(),clearTimeout(a),t(null===(o=e.value)||void 0===o?void 0:o.modelIds)})),a=setTimeout((()=>{var o;i&&i(),t(null===(o=e.value)||void 0===o?void 0:o.modelIds)}),400)}),{immediate:!1})},se=(e,t)=>{const{activeSheetViewerState:o}=(0,c.nZ)(),i=(0,n.YP)((()=>o.value.editSession),(o=>{if(null===o){i&&i();const o=(0,n.YP)((()=>(0,l.A)().commands),(()=>{var n;o&&o(),clearTimeout(a),t(null===(n=e.value)||void 0===n?void 0:n.modelIds)})),a=setTimeout((()=>{var n;o&&o(),t(null===(n=e.value)||void 0===n?void 0:n.modelIds)}),400)}}))};function ue(){!function(){const{document:e,isDirtyDocument:t}=(0,c.nZ)(),o=(0,s.F)(),i=(0,u.Ds)((()=>m(this,void 0,void 0,(function*(){yield o.saveTemp(),yield o.updateMemento(!1)}))),2e3);(0,n.YP)(e,((e,n)=>{e&&n&&(o.changeDirty(t()),i())})),(0,n.YP)((()=>o.password),(()=>m(this,void 0,void 0,(function*(){yield o.saveTemp(),yield o.updateMemento(!1)}))))}(),Z(),function(){const e=(0,s.F)(),t=[e.addFileEventHook("open",(t=>{"postopen"===t&&e.source.startsWith("file:")&&setTimeout((()=>{G()}),2e3)})),e.addFileEventHook("save",(e=>{"postsave"===e&&(G(),(0,R.L9)({eventCategory:"Save",eventAction:"save",eventValue:1}))})),e.addFileEventHook("saveAs",(e=>{"postsaveas"===e&&(G(),(0,R.L9)({eventCategory:"Save",eventAction:"saveAs",eventValue:1}))}))];t.push(e.addFileEventHook("open",(t=>{"postopen"===t&&e.source.startsWith("file:")&&setTimeout((()=>{G()}),200)}))),t.push(e.addFileEventHook("save",(e=>{"postsave"===e&&(G(),(0,R.L9)({eventCategory:"Save",eventAction:"save",eventValue:1}))}))),t.push(e.addFileEventHook("saveAs",(e=>{"postsaveas"===e&&(G(),(0,R.L9)({eventCategory:"Save",eventAction:"saveAs",eventValue:1}))}))),(0,n.Jd)((()=>{t.forEach((e=>e()))}))}(),function(){const{editorContainer:e,sheets:t,getSheetViewer:o}=(0,c.nZ)(),i=(0,d.$)();(0,n.YP)((()=>i.editorMode),(()=>{"snowbrush"===i.editorMode&&t.value.forEach((e=>{var t;return null===(t=o(e.id))||void 0===t?void 0:t.checkSize()}))}));let a=null;(0,n.bv)((()=>{(0,n.YP)((()=>e.value),(()=>{a&&(a.disconnect(),a=null),e.value&&(a=new ResizeObserver((0,u.Ds)((()=>{t.value.forEach((e=>{var t;return null===(t=o(e.id))||void 0===t?void 0:t.checkSize()}))}),50)),a.observe(e.value))}))}))}(),le(),U();const{updateEditorVisible:e}=(0,r.E)();return{updateEditorVisible:e}}const me=(0,n.aZ)({__name:"editor",props:{progressIndicatorText:{default:""}},setup(e){const t=(0,n.RC)((()=>o.e(9891).then(o.bind(o,49891)))),s=(0,n.RC)((()=>Promise.all([o.e(6486),o.e(2118),o.e(5303)]).then(o.bind(o,45303)))),u=(0,n.RC)((()=>Promise.all([o.e(6486),o.e(2777),o.e(4741)]).then(o.bind(o,4741)))),m=(0,n.RC)((()=>o.e(397).then(o.bind(o,90397)))),v=(0,n.RC)((()=>o.e(6197).then(o.bind(o,86197)))),p=(0,n.RC)((()=>Promise.all([o.e(5644),o.e(2217)]).then(o.bind(o,82217)))),h=(0,n.RC)((()=>Promise.all([o.e(1248),o.e(7088)]).then(o.bind(o,67088)))),f=(0,n.RC)((()=>o.e(5388).then(o.bind(o,35388)))),g=(0,n.RC)((()=>o.e(371).then(o.bind(o,60371)))),I=(0,n.RC)((()=>Promise.all([o.e(7462),o.e(7043)]).then(o.bind(o,17043)))),b=(0,n.RC)((()=>o.e(1383).then(o.bind(o,21383)))),y=(0,n.RC)((()=>o.e(5428).then(o.bind(o,85428)))),T=(0,n.RC)((()=>o.e(1626).then(o.bind(o,71626)))),E=(0,c.pk)(),{selection:w,isInBranchOnly:S,executeEditorAction:k,changeLanguage:O}=(0,c.nZ)(),{updateEditorVisible:M}=ue(),{updateRightBarPanel:A,updateIconPanel:x,updateWorkbenchReady:P}=(0,d.$)(),C=(0,n.iH)(!1),L=(0,n.Fl)((()=>(0,d.$)().isOutlinerMode)),R=(0,n.Fl)((()=>(0,d.$)().pitchMode)),D=(0,n.Fl)((()=>(0,r.E)().isTryPicthModeVisible)),B=(0,n.Fl)((()=>(0,d.$)().zenMode)),H=(0,n.Fl)((()=>{var e;return B.value&&(null===(e=(0,l.r)())||void 0===e?void 0:e.activeEditorId)===window.editorId})),N=(0,n.Fl)((()=>{var e;return null===(e=(0,l.A)())||void 0===e?void 0:e.aggregatedContexts["editor.inMapShotMode"]})),Z=(0,n.Fl)((()=>(0,r.E)().isBeginnerModeVisible)),V=(0,n.Fl)((()=>""!==(0,r.E)().audioBarMode&&!L.value)),_=(0,n.Fl)((()=>S.value)),K=(0,n.Fl)((()=>{switch((0,d.$)().popoverEditorVisible){case"equation":return g;case"label":return f;case"notes":return I;case"markerpopup":return b;case"informationcard":return y}})),G=(0,n.iH)(!1),q=e=>{G.value=e},W=(0,n.iH)(null),J=e=>{W.value=e},Y=(0,n.iH)(null),U=e=>{Y.value=e};let $=null;const z=(0,n.Fl)((()=>{var e,t;return{left:((null===(e=null==Y?void 0:Y.value)||void 0===e?void 0:e.left)||0)+"px",top:((null===(t=null==Y?void 0:Y.value)||void 0===t?void 0:t.top)||0)+"px",visibility:G.value?"visible":"hidden"}})),X=(0,n.iH)(null),j=(0,n.Fl)((()=>(0,r.E)().sheetRendering)),Q=(e,t)=>{A({panel:e,tab:t})},ee=()=>{var e;(null===(e=w.value)||void 0===e?void 0:e.modelIds.length)>0?(0,d.$)().rightBarPanel===F.QN.THEME&&Q(F.QN.FORMAT,(0,d.$)().rightPanelTab[F.QN.FORMAT]):(0,d.$)().rightBarPanel===F.QN.FORMAT&&Q(F.QN.THEME,(0,d.$)().rightPanelTab[F.QN.THEME])};return(0,n.YP)((()=>w.value),(()=>{ee()})),(0,n.YP)((()=>(0,d.$)().editorMode),(e=>{A({visible:!1}),x({visible:!1}),e===a.hO&&(Q(F.QN.FORMAT),ee()),e===a.Pq&&Q(F.QN.IMAGE,F.ll.MARKER)})),(0,n.YP)((()=>(0,d.$)().zenMode),(e=>{A({visible:!1}),e?(x({visible:!1}),k({name:"mutateEditor:changeShowMapOverview",inputValue:!1})):(A({panel:F.QN.FORMAT}),ee())})),(0,n.YP)((()=>(0,i.S)().language),(e=>O(e)),{immediate:!0}),(0,n.YP)((0,c.nZ)().activeSheetViewerInited,(e=>{C.value=e})),(0,n.bv)((()=>{const e=document.getElementById("editor-container");E.setContainer(e),M(!0),P(!0)})),(e=>{const{document:t,installHoverChangedTaskHandler:o}=(0,c.nZ)();o((o=>{var n;if(!o)return void e(null);const i=null===(n=t.value.query({id:o.topicId}))||void 0===n?void 0:n.asTopic();i&&null!==i.aggregatedCountOfTodos?e({location:o.location,topic:i}):e(null)}))})((e=>{if(q(!1),$&&(clearTimeout($),$=null),!e||null===e.topic.aggregatedCountOfTodos)return;const t=Math.round(e.topic.aggregatedCountOfCheckedTodos/e.topic.aggregatedCountOfTodos*100);J(`${e.topic.aggregatedCountOfCheckedTodos}/${e.topic.aggregatedCountOfTodos} (${t}%)`),$=setTimeout((()=>{var t,o,n,i;if(!e||null===e.topic.aggregatedCountOfTodos)return void q(!1);const a=e.location;U({left:a.x-((null===(o=null===(t=X.value)||void 0===t?void 0:t.getBoundingClientRect())||void 0===o?void 0:o.width)||0)/2+9,top:a.y-((null===(i=null===(n=X.value)||void 0===n?void 0:n.getBoundingClientRect())||void 0===i?void 0:i.height)||0)-12}),q(!0)}),1e3)})),{__sfc:!0,TASK_TOOLTIP_SHOW_DELAY:1e3,TASK_TOOLTIP_LEFT_OFFSET:9,TASK_TOOLTIP_TOP_OFFSET:-12,Spinner:t,Pitch:s,ZenModeBar:u,BeginnerMode:m,BranchOnlyBar:v,AudioBar:p,TryPitchMode:h,LabelEditor:f,EquationEditor:g,NoteEditor:I,MarkerEditor:b,Informationcard:y,TutorialDialog:T,snowdance:E,selection:w,isInBranchOnly:S,executeEditorAction:k,changeLanguage:O,updateEditorVisible:M,updateRightBarPanel:A,updateIconPanel:x,updateWorkbenchReady:P,isMindMapInited:C,isOutlineMode:L,isPitchMode:R,isTryPicthModeVisible:D,isZenMode:B,isZenModeBarVisible:H,isInMapShotMode:N,isBeginnerModeVisible:Z,isAudioBarEnable:V,isBranchOnlyMode:_,currentPopoverEditor:K,tooltipVisible:G,changeTooltipVisible:q,tooltipContent:W,changeTooltipContent:J,tooltipLocation:Y,changeTooltipLocation:U,tooltipTimeout:$,tooltipStyle:z,tooltipRef:X,sheetRendering:j,switchRightPanelTab:Q,updateRightPanelTab:ee}}});o(52960);const ve=(0,o(51900).Z)(me,(function(){var e=this,t=e._self._c,o=e._self._setupProxy;return t("div",{staticClass:"uk-panel uk-position-cover uk-flex uk-flex-column uk-child-separator"},[o.isBranchOnlyMode&&!o.isInMapShotMode?t(o.BranchOnlyBar,{staticClass:"uk-position-absolute",staticStyle:{left:"20px",top:"20px","z-index":"1"}}):e._e(),e._v(" "),t("div",{staticClass:"uk-height-1-1 uk-width-1-1 uk-position-relative uk-background-default",attrs:{id:"zen-mode-container"}},[t("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:group",value:["focus.mindMap"],expression:"['focus.mindMap']",arg:"group"}],staticClass:"uk-panel uk-position-cover",attrs:{id:"editor-container"}}),e._v(" "),o.isAudioBarEnable?t(o.AudioBar,{directives:[{name:"show",rawName:"v-show",value:!o.isInMapShotMode,expression:"!isInMapShotMode"}]}):e._e(),e._v(" "),t(o.currentPopoverEditor,{tag:"component"}),e._v(" "),o.isZenModeBarVisible?[t(o.ZenModeBar),e._v(" "),t(o.Spinner,{directives:[{name:"show",rawName:"v-show",value:o.sheetRendering||!o.isMindMapInited,expression:"sheetRendering || !isMindMapInited"}],staticClass:"uk-position-cover sheet-rendering-mask",attrs:{text:e.progressIndicatorText}})]:e._e(),e._v(" "),t("transition",{attrs:{name:"beginner"}},[o.isBeginnerModeVisible&&!o.isZenMode?t(o.BeginnerMode):e._e()],1),e._v(" "),t("transition",{attrs:{name:"dialog"}},[t(o.TutorialDialog)],1),e._v(" "),t("transition",{attrs:{name:"try-pitch-mode"}},[!o.isOutlineMode&&o.isTryPicthModeVisible?t(o.TryPitchMode):e._e()],1),e._v(" "),t("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:group",value:["focus.popover"],expression:"['focus.popover']",arg:"group"}],attrs:{id:"popover-container-for-editor"}}),e._v(" "),o.isPitchMode?t(o.Pitch):e._e(),e._v(" "),o.tooltipContent?t("div",{ref:"tooltipRef",staticClass:"editor-tooltip",style:o.tooltipStyle},[e._v("\n      "+e._s(o.tooltipContent)+"\n    ")]):e._e()],2)],1)}),[],!1,null,"117f9b53",null).exports},52960:(e,t,o)=>{var n=o(26978);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,o(45346).Z)("3bb68a0d",n,!0,{})}}]);